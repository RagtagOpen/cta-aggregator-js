<div>
  <h3>Advocacy Campaigns</h3>
  {{#if loading}}
    loading...
  {{/if}}
  {{#each ctas as cta}}
    <div>
      <h4><a href="{{cta.browser_url}}">{{cta.title}}</a> ({{cta.origin_system}})</h4>
      <div>type: {{cta.action_type}}</div>
      <p>{{cta.description}}</p>
      <p>{{cta.template}}</p>
      <ul>
      {{#each cta.target_list as target}}
        <li>
          {{target.given_name}} {{target.family_name}} ({{target.organization}})
          <ul>
            {{#if cta.action_type === 'email'}}
              {{#each target.email_addresses as email}}
                <li><a href="mailto:{{email.address}}">{{email.address}}</a></li>
              {{/each}}
            {{/if}}
            {{#if cta.action_type === 'phone'}}
              {{#each target.phone_numbers as phone}}
                <li>
                  {{phone.number}}
                  {{#if phone.extension}}
                    x{{phone.extension}}
                  {{/if}}
                </li>
              {{/each}}
            {{/if}}
            {{#if cta.action_type === 'postal mail' || cta.action_type === 'in-person'}}
              {{#each target.postal_addresses as address}}
                <li>
                  {{address.venue}}
                  {{address.address_lines.join(", ")}}
                  {{address.locality}}, {{address.region}} {{address.country}}
                </li>
              {{/each}}
            {{/if}}
          </ul>
        </li>
      {{/each}}
      </ul>
    </div>
  {{/each}}
</div>

<script>
  import Api from '../api'
  export default {
    data() {
      return {
        loading: true,
        ctas: []
      }
    },
    oncreate() {
      if (!this.api) this.api = Api({ baseUrl : this.get('baseUrl') || process.env.API_URL })
      this.api.ctas().then(function(ctas) {
        console.log("first cta:", ctas[0])
        this.set({ ctas, loading: false })
      }.bind(this))
    }
  }
</script>
